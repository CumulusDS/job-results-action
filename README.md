[![Create Release](https://github.com/CumulusDS/job-results-action/actions/workflows/release.yml/badge.svg)](https://github.com/CumulusDS/job-results-action/actions/workflows/release.yml)  
[![Import Labels](https://github.com/CumulusDS/job-results-action/actions/workflows/labels_import.yml/badge.svg)](https://github.com/CumulusDS/job-results-action/actions/workflows/labels_import.yml)  [![Sync Labels](https://github.com/CumulusDS/job-results-action/actions/workflows/labels_sync.yml/badge.svg)](https://github.com/CumulusDS/job-results-action/actions/workflows/labels_sync.yml)  
[![PR AutoLabeler](https://github.com/CumulusDS/job-results-action/actions/workflows/autolabeler.yml/badge.svg)](https://github.com/CumulusDS/job-results-action/actions/workflows/autolabeler.yml)  [![Assigner](https://github.com/CumulusDS/job-results-action/actions/workflows/assign.yml/badge.svg)](https://github.com/CumulusDS/job-results-action/actions/workflows/assign.yml)  

Returns results of previous jobs in workflow; prepares a message for sending to slack deployment status.  
This action is intended to be run on pushes to refs/tags/ or on the `release` event (`github.event.action == 'released'`)

### Inputs
#### `token`
Required input.  
Token with appropriate access.

#### `matrix`
Required input.    
Can be an output from a previous step.  Used to specify jobs to filter for from previous jobs in workflow.

Use with toJson() function when providing a matrix generated by a previous job
 
### Environment Variable Outputs
This actions outputs are in the form of environment variables:

#### `env.changelog`
Will use the slack API to grab the release notes from the tagged version that this action is running against.  

#### `env.changelogUrl`
The URL associated with the above changelog.

#### `env.totalJobs`
The number of previous jobs.

#### `env.results`
The results of the previous jobs.

#### `env.randomFact`
Just a random fun fact.

#### `env.statusMessage`
Message that can be used to notify users of deployment status


### Example usage
```yaml
      - name: Get Results
        id: jobs
        uses: CumulusDS/job-results-action@master
        if: always
        with:
          token: ${{ secrets.TOKEN_WITH_ACCESS }}
          matrix: ${{ toJson(needs.unit.outputs.matrix) }}
```

Using action created environment variables in later steps, e.g. to send a notification to slack
or to convert release notes from markdown to slack mrkdwn format

```yaml
      - name: Convert changelog markdown syntax to mrkdwn syntax
        id: slackify
        uses: LoveToKnow/slackify-markdown-action@v1
        if: always()
        with:
          text: ${{ env.changelog }}
```

```yaml
      - name: Notify deployment
        id: notify
        uses: rtCamp/action-slack-notify@v2.1.3
        if: always()
        env:
          SLACK_CHANNEL: Software
          SLACK_USERNAME: "${{ env.REPO }}"
          SLACK_ICON: "https://upload.wikimedia.org/wikipedia/commons/0/05/HONDA_ASIMO.jpg"
          SLACK_ICON_EMOJI: ":bell:"
          SLACK_COLOR: "#2D50FF"
          MSG_MINIMAL: true
          SLACK_TITLE: "${{ env.VERSION }} Deployment Status:"
          SLACK_MESSAGE: |
            ${{ env.statusMessage }}
          SLACK_FOOTER: "Random fact: ${{ env.randomFact }}"
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
```

```yaml
      - name: Changelog
        id: changelog
        uses: rtCamp/action-slack-notify@v2.1.3
        if: always()
        env:
          SLACK_CHANNEL: Software
          SLACK_USERNAME: "${{ env.REPO }}"
          SLACK_ICON: "https://upload.wikimedia.org/wikipedia/commons/0/05/HONDA_ASIMO.jpg"
          SLACK_ICON_EMOJI: ":spiral_note_pad:"
          SLACK_COLOR: "#2D50FF"
          MSG_MINIMAL: true
          SLACK_TITLE: "${{ env.VERSION }} Changelog"
          SLACK_MESSAGE: |
            ${{ env.changelogUrl }}

            ${{ steps.slackify.outputs.text }}
          SLACK_FOOTER: ""
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
```
